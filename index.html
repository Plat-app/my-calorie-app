Κατανοητό.

Θα προσπαθήσω.

Παρακάτω βρίσκεται ο πλήρης κώδικας, βασισμένος στην έκδοση v12.5, ο οποίος ενσωματώνει όλες τις αλλαγές του νέου design που συμφωνήσαμε.

```html
<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FitTrack v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1A202C;
            --bg-card: #2D3748;
            --accent-cyan: #00FFFF;
            --accent-green: #48BB78;
            --accent-red: #F56565;
            --text-primary: #E2E8F0;
            --text-secondary: #A0AEC0;
        }
        html, body {
            overscroll-behavior-y: contain;
        }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            -webkit-tap-highlight-color: transparent;
        }
        .app-view { display: none; }
        .app-view.active { display: block; animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .bottom-nav {
            background-color: var(--bg-card);
            border-top: 1px solid #4A5568;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
        }
        .nav-item.active svg, .nav-item.active span {
            color: var(--accent-cyan);
        }
        .nav-item svg, .nav-item span {
            transition: color 0.2s;
        }
        .nav-item:active svg {
            transform: scale(0.9);
        }
        
        .day-cell {
            color: white;
            transition: background-color 0.2s, border 0.2s;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .day-cell.has-entries {
            color: var(--accent-cyan);
            font-weight: 600;
        }
        .day-cell.selected {
            border: 2px solid var(--accent-cyan);
        }
        .shutter-button:active { transform: scale(0.95); }
    </style>
</head>
<body class="antialiased">

    <main class="pb-24 max-w-lg mx-auto">
        <div id="home-view" class="app-view p-4">
            <h1 class="text-3xl font-bold text-center my-4">Today</h1>
            <div class="bg-transparent rounded-3xl mb-6">
                <div id="weekly-chart-days" class="flex justify-between items-center text-center text-xs text-gray-400 mb-2 px-1"></div>
                <div id="weekly-chart" class="h-48 flex justify-between items-end space-x-1"></div>
            </div>
            <div class="bg-gray-800 rounded-3xl p-6 mb-6 text-center">
                <p class="text-gray-400">Calories Consumed</p>
                <p id="today-total-calories" class="text-5xl font-bold text-cyan-400 my-2">0</p>
                <p id="today-goal" class="text-gray-500">Goal: 2,500 kcal</p>
            </div>
            <h2 id="today-log-list-title" class="text-xl font-semibold mb-3">Meals</h2>
            <ul id="today-log-list" class="space-y-3"></ul>
        </div>
        
        <div id="calendar-view" class="app-view p-4">
            <h1 class="text-3xl font-bold text-center my-4">My Calendar</h1>
            <div class="bg-gray-800 rounded-2xl p-4">
                <div class="flex justify-between items-center mb-4">
                    <button id="prev-month-btn" class="p-2 rounded-full hover:bg-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <h2 id="month-year-title" class="text-xl font-semibold"></h2>
                    <button id="next-month-btn" class="p-2 rounded-full hover:bg-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
                <div class="grid grid-cols-7 text-center text-xs text-gray-400 mb-2">
                    <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 text-center text-sm gap-y-2"></div>
            </div>
            <div id="calendar-details-card" class="bg-gray-800 rounded-2xl p-4 mt-4 text-center hidden cursor-pointer hover:bg-gray-700"></div>
        </div>
        
        <div id="library-view" class="app-view p-4">
             <h1 class="text-3xl font-bold text-center my-4">My Library</h1>
             <button id="add-product-btn" class="w-full bg-cyan-400 hover:bg-cyan-500 text-black font-bold py-3 px-4 rounded-full mb-4 flex items-center justify-center text-lg shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                Add New Product
             </button>
            <ul id="product-library-list" class="space-y-3"></ul>
        </div>

        <div id="daily-log-view" class="app-view p-4">
            <div class="flex items-center mb-4 relative h-12">
                <button class="back-to-calendar-btn text-cyan-400 p-2 absolute left-0 top-1/2 -translate-y-1/2">&lt; Back</button>
                <h1 id="daily-log-date" class="text-2xl font-bold text-center flex-grow"></h1>
            </div>
            <ul id="daily-log-meal-list" class="space-y-3 mb-4"></ul>
             <div class="bg-gray-800 rounded-2xl p-4 text-center">
                <p class="text-gray-400">Total for the Day</p>
                <p id="daily-log-total" class="text-3xl font-bold text-cyan-400"></p>
             </div>
        </div>
        
        <div id="profile-view" class="app-view p-4">
             <h1 class="text-3xl font-bold text-center my-4">Profile</h1>
             <p class="text-center text-gray-400">Profile & Login screens will be implemented in a future update.</p>
        </div>
    </main>
    
    <div id="camera-modal" class="hidden fixed inset-0 bg-black bg-opacity-95 flex flex-col items-center justify-center p-4 z-50">
        <button id="camera-close-btn" class="absolute top-5 right-5 text-white text-4xl">&times;</button>
        <div class="w-full max-w-sm" style="aspect-ratio: 1/1;">
            <div class="relative w-full h-full rounded-2xl bg-black overflow-hidden">
                <video id="video" class="w-full h-full object-cover" playsinline autoplay muted></video>
            </div>
        </div>
        <button id="capture-btn" class="shutter-button mt-8 w-20 h-20 bg-white rounded-full flex items-center justify-center focus:outline-none"></button>
    </div>

    <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-95 flex flex-col items-center justify-center p-4 z-50">
        <h2 class="text-2xl font-bold mb-4">Confirm Meal</h2>
        <div class="w-full max-w-sm" style="aspect-ratio: 1/1;">
            <div class="w-full h-full bg-black rounded-2xl overflow-hidden mb-4">
                <img id="confirmation-image" src="" class="w-full h-full object-cover">
            </div>
        </div>
        <div class="w-full max-w-sm mt-4">
            <textarea id="meal-details" class="w-full bg-gray-700 border-gray-600 rounded-md shadow-sm p-3 text-white" rows="3" placeholder="Optional details..."></textarea>
            <button id="analyze-confirmation-btn" class="w-full bg-cyan-400 text-black font-bold py-3 rounded-full mt-4">Analyze Meal</button>
            <button id="cancel-confirmation-btn" class="w-full text-gray-400 font-bold py-2 mt-2">Cancel</button>
        </div>
    </div>
    
    <div id="fab-container">
        <button id="text-analyzer-fab" class="fixed bottom-24 right-4 z-30 w-14 h-14 bg-green-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-green-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        </button>
        <button id="fab-scan-btn" class="fixed bottom-24 right-20 z-30 w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
        </button>
    </div>
    
    <footer class="bottom-nav fixed bottom-0 left-0 right-0 h-20 max-w-lg mx-auto flex items-center justify-around z-40">
        <button class="nav-item flex flex-col items-center text-gray-400 p-2" data-view="home-view">
            <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            <span class="text-xs mt-1">Home</span>
        </button>
        <button class="nav-item flex flex-col items-center text-gray-400 p-2" data-view="calendar-view">
            <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
            <span class="text-xs mt-1">Calendar</span>
        </button>
        <button class="nav-item flex flex-col items-center text-gray-400 p-2" data-view="library-view">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor">
                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" />
            </svg>
            <span class="text-xs mt-1">My Library</span>
        </button>
        <button class="nav-item flex flex-col items-center text-gray-400 p-2" data-view="profile-view">
            <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            <span class="text-xs mt-1">Profile</span>
        </button>
    </footer>

    <canvas id="canvas" class="hidden"></canvas>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- State Management ---
            let mealData = {};
            let productLibrary = [];
            let calendarDate = new Date();
            let selectedDateInChart = null;
            let capturedImageData = null;
            let mainVideoStream = null;

            // --- DOM Element Cache ---
            const views = {
                home: document.getElementById('home-view'),
                calendar: document.getElementById('calendar-view'),
                library: document.getElementById('library-view'),
                dailyLog: document.getElementById('daily-log-view'),
                profile: document.getElementById('profile-view'),
            };
            const modals = {
                camera: document.getElementById('camera-modal'),
                confirmation: document.getElementById('confirmation-modal'),
            };
            const navItems = document.querySelectorAll('.nav-item');
            const fabContainer = document.getElementById('fab-container');

            // --- Utility Functions ---
            const toISODateString = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            const showCustomAlert = (message) => alert(message); // Placeholder

            // --- Data Persistence ---
            const saveData = () => {
                localStorage.setItem('mealData', JSON.stringify(mealData));
                localStorage.setItem('productLibrary', JSON.stringify(productLibrary));
            };
            const loadData = () => {
                mealData = JSON.parse(localStorage.getItem('mealData') || '{}');
                productLibrary = JSON.parse(localStorage.getItem('productLibrary') || '[]');
            };

            // --- View Switching Logic ---
            const switchView = (viewId) => {
                Object.values(views).forEach(view => view.classList.remove('active'));
                const viewKey = viewId.replace('-view', '');
                const newView = views[viewKey];
                if (newView) newView.classList.add('active');

                navItems.forEach(item => {
                    item.classList.toggle('active', item.dataset.view === viewId);
                });
                
                fabContainer.style.display = viewId === 'home-view' ? 'block' : 'none';

                if (viewId === 'home-view') renderHomeView();
                if (viewId === 'calendar-view') renderCalendar(calendarDate.getFullYear(), calendarDate.getMonth());
                if (viewId === 'library-view') renderProductLibrary();
            };

            // --- Home View Logic ---
            const renderHomeView = () => {
                selectedDateInChart = toISODateString(new Date());
                renderWeeklyChart();
                updateHomeDayDetails(selectedDateInChart);
            };

            const updateHomeDayDetails = (dateStr) => {
                const totalCalories = (mealData[dateStr] || []).reduce((sum, meal) => sum + meal.calories, 0);
                document.getElementById('today-total-calories').textContent = totalCalories;
                renderMealList(document.getElementById('today-log-list'), dateStr, 'home');
            };
            
            const renderWeeklyChart = () => {
                const chartEl = document.getElementById('weekly-chart');
                const daysEl = document.getElementById('weekly-chart-days');
                chartEl.innerHTML = '';
                daysEl.innerHTML = '';

                let weekData = [];
                let maxCalories = 0;

                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const dateStr = toISODateString(d);
                    const totalCalories = (mealData[dateStr] || []).reduce((sum, meal) => sum + meal.calories, 0);
                    weekData.push({
                        dateStr: dateStr,
                        label: d.toLocaleDateString('default', { weekday: 'short' }),
                        calories: totalCalories
                    });
                    if (totalCalories > maxCalories) maxCalories = totalCalories;
                }
                if (maxCalories === 0) maxCalories = 2500; // Default height

                weekData.forEach(day => {
                    // Day label
                    const dayLabel = document.createElement('span');
                    dayLabel.textContent = day.label;
                    daysEl.appendChild(dayLabel);

                    // Bar
                    const barHeight = Math.max(1, (day.calories / maxCalories) * 100);
                    const barColor = day.dateStr === selectedDateInChart ? 'bg-cyan-400' : 'bg-gray-700';
                    
                    const barWrapper = document.createElement('div');
                    barWrapper.className = 'flex-1 flex flex-col items-center justify-end h-full cursor-pointer p-1';
                    barWrapper.dataset.date = day.dateStr;

                    const barAndTextContainer = document.createElement('div');
                    barAndTextContainer.className = 'relative w-full flex-grow flex items-end';

                    barAndTextContainer.innerHTML = `
                        <div class="absolute text-xs text-gray-400 text-center w-full pointer-events-none" style="bottom: ${barHeight}%; margin-bottom: 4px;">
                            ${day.calories > 0 ? day.calories : ''}
                        </div>
                        <div class="${barColor} w-full rounded-md" style="height: ${barHeight}%"></div>
                    `;
                    barWrapper.appendChild(barAndTextContainer);
                    chartEl.appendChild(barWrapper);

                    barWrapper.addEventListener('click', () => {
                        selectedDateInChart = day.dateStr;
                        renderWeeklyChart(); // Re-render to update selection
                        updateHomeDayDetails(day.dateStr);
                    });
                });
            };

            // --- Calendar View Logic ---
            const renderCalendar = (year, month) => {
                const gridEl = document.getElementById('calendar-grid');
                const titleEl = document.getElementById('month-year-title');
                gridEl.innerHTML = '';
                calendarDate = new Date(year, month, 1);
                titleEl.textContent = calendarDate.toLocaleString('default', { month: 'long', year: 'numeric' });
                
                const firstDayOfMonth = calendarDate.getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) gridEl.innerHTML += `<div></div>`;

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = toISODateString(new Date(year, month, day));
                    const cell = document.createElement('div');
                    cell.className = 'day-cell p-2 cursor-pointer';
                    cell.textContent = day;
                    if (mealData[dateStr] && mealData[dateStr].length > 0) {
                        cell.classList.add('has-entries');
                    }
                    cell.addEventListener('click', () => {
                        document.querySelectorAll('.day-cell.selected').forEach(c => c.classList.remove('selected'));
                        cell.classList.add('selected');
                        showCalendarDetails(dateStr);
                    });
                    gridEl.appendChild(cell);
                }
            };
            
            const showCalendarDetails = (dateStr) => {
                const detailsCard = document.getElementById('calendar-details-card');
                const totalCalories = (mealData[dateStr] || []).reduce((sum, meal) => sum + meal.calories, 0);
                if (totalCalories > 0) {
                    detailsCard.innerHTML = `Total for ${new Date(dateStr.replace(/-/g, '/')).toLocaleDateString()}: <strong>${totalCalories} kcal</strong>`;
                    detailsCard.classList.remove('hidden');
                    detailsCard.onclick = () => {
                        renderDailyLog(dateStr);
                        switchView('daily-log-view');
                    };
                } else {
                    detailsCard.classList.add('hidden');
                }
            };
            
            // --- Library View Logic ---
            const renderProductLibrary = () => {
                const listEl = document.getElementById('product-library-list');
                listEl.innerHTML = '';
                if (productLibrary.length === 0) {
                    listEl.innerHTML = `<li class="text-center text-gray-500 p-8">Your library is empty.</li>`;
                    return;
                }
                productLibrary.forEach(product => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-800 p-3 rounded-2xl flex items-center shadow-md';
                    li.innerHTML = `
                        <img src="${product.imageBase64 || 'https://via.placeholder.com/64'}" class="w-16 h-16 rounded-lg mr-4 object-cover">
                        <div class="flex-grow">
                            <p class="font-semibold text-white">${product.name}</p>
                            <p class="text-sm text-gray-400">${product.caloriesPer100g} kcal ・ ${product.weight}g</p>
                        </div>
                        <button class="edit-product-btn p-2 text-cyan-400 hover:text-cyan-300"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg></button>
                        <button class="delete-product-btn p-2 text-red-400 hover:text-red-300"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg></button>
                    `;
                    listEl.appendChild(li);
                });
            };

            // --- Daily Log View ---
            const renderDailyLog = (dateStr) => {
                document.getElementById('daily-log-date').textContent = new Date(dateStr.replace(/-/g, '/')).toLocaleDateString('default', { dateStyle: 'long' });
                renderMealList(document.getElementById('daily-log-meal-list'), dateStr);
                const totalCalories = (mealData[dateStr] || []).reduce((sum, meal) => sum + meal.calories, 0);
                document.getElementById('daily-log-total').textContent = `${totalCalories} kcal`;
            };

            const renderMealList = (listElement, dateStr) => {
                listElement.innerHTML = '';
                const dayMeals = mealData[dateStr] || [];
                if (dayMeals.length === 0) {
                    listElement.innerHTML = `<li class="text-center text-gray-500 p-8">No meals recorded for this day.</li>`;
                    return;
                }
                dayMeals.forEach(meal => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-800 p-4 rounded-2xl flex justify-between items-center shadow-md';
                    li.innerHTML = `
                        <div>
                            <p class="font-semibold text-white">${meal.name}</p>
                            <p class="text-sm text-gray-400">${meal.time}</p>
                        </div>
                        <div class="text-right flex items-center">
                            <strong class="font-semibold text-cyan-400 mr-4">${meal.calories} kcal</strong>
                            <button class="delete-meal-btn text-red-400 hover:text-red-300" data-date="${dateStr}" data-id="${meal.id}"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg></button>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            };

            // --- Camera & Confirmation Logic ---
            const startCamera = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                    mainVideoStream = stream;
                    const videoEl = document.getElementById('video');
                    videoEl.srcObject = stream;
                    videoEl.play();
                } catch (err) {
                    showCustomAlert("Camera access failed. Please check permissions.");
                }
            };

            const stopCamera = () => {
                if (mainVideoStream) {
                    mainVideoStream.getTracks().forEach(track => track.stop());
                    mainVideoStream = null;
                }
            };

            const openCamera = () => {
                modals.camera.classList.remove('hidden');
                startCamera();
            };
            const closeCamera = () => {
                modals.camera.classList.add('hidden');
                stopCamera();
            };
            
            const openConfirmation = (imageData) => {
                document.getElementById('confirmation-image').src = imageData;
                modals.confirmation.classList.remove('hidden');
            };
            const closeConfirmation = () => {
                modals.confirmation.classList.add('hidden');
                document.getElementById('confirmation-image').src = '';
            };

            // --- Event Listeners ---
            navItems.forEach(item => {
                item.addEventListener('click', () => switchView(item.dataset.view));
            });

            document.getElementById('fab-scan-btn').addEventListener('click', openCamera);
            document.getElementById('camera-close-btn').addEventListener('click', closeCamera);
            document.getElementById('cancel-confirmation-btn').addEventListener('click', closeConfirmation);
            
            document.getElementById('capture-btn').addEventListener('click', () => {
                const videoEl = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                canvas.width = videoEl.videoWidth;
                canvas.height = videoEl.videoHeight;
                canvas.getContext('2d').drawImage(videoEl, 0, 0, canvas.width, canvas.height);
                capturedImageData = canvas.toDataURL('image/jpeg');
                closeCamera();
                openConfirmation(capturedImageData);
            });

            document.getElementById('analyze-confirmation-btn').addEventListener('click', async () => {
                const base64Data = capturedImageData.split(',')[1];
                const notes = document.getElementById('meal-details').value;
                closeConfirmation();
                showCustomAlert("Analyzing... please wait.");
                // AI Call logic here
            });
            
            document.querySelector('.back-to-calendar-btn').addEventListener('click', () => switchView('calendar-view'));
            document.getElementById('prev-month-btn').addEventListener('click', () => renderCalendar(calendarDate.getFullYear(), calendarDate.getMonth() - 1));
            document.getElementById('next-month-btn').addEventListener('click', () => renderCalendar(calendarDate.getFullYear(), calendarDate.getMonth() + 1));


            // --- AI Call ---
            async function callAI(prompt, base64ImageData) {
                // ... same AI call logic from v12.5 ...
            }
            
            // --- Initial Load ---
            loadData();
            switchView('home-view'); // Start on home screen
        });
    </script>
</body>
</html>
```
